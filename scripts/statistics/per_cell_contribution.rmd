---
title: "per_cell_contribution"
author: "ryan"
date: '2023-02-13'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(tidyverse)
library(lme4)
library(lmerTest)
library(MASS)
library(DHARMa)
library(ggplot2)
library(effectsize)
library(EMAtools)
```



```{r}
data <- read.csv("Z:/home/ryanh/projects/ripple_heterogeneity/per_cell_contribution.csv")

data = data[data$deepSuperficial == "Deep" | data$deepSuperficial == "Superficial",]
# data = data[data$session_structure == "task" | data$session_structure == "post",]
data = data[data$session_structure == "task",]

# data = data[data$pcc >-100 & data$pcc <100,]

data$deepSuperficial = factor(data$deepSuperficial)
data$basepath = factor(data$basepath)
data$animal_id = factor(data$animal_id)
data$replay_n = factor(data$replay_n)
data$start = factor(data$start)


summary(data)

```


```{r}
data$y_trans <- data$pcc

# mdl_boxcox <- boxcox(y_trans ~ deepSuperficial, data=data, lambda = seq(-5, 10, length = 100))
# max_lambda <- mdl_boxcox$x[max(mdl_boxcox$y) == mdl_boxcox$y]
# data$y_trans <- data$y_trans^max_lambda
# data$y_trans <- log(data$y_trans)

m1 = lmer(y_trans ~ deepSuperficial + (1 | animal_id/basepath), data = data, REML=FALSE)
summary(m1)

simulationOutput <- simulateResiduals(fittedModel = m1, plot = F)
plot(simulationOutput)

a1 = anova(m1)
F_to_eta2(a1$`F value`, a1$NumDF, a1$DenDF)

lme.dscore(m1,data=data,type="lme4")
plot(pcc ~ deepSuperficial, data = data)
```

```{r}
data$y_trans
```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```